#pragma once

#include "Core/PrimeHack/PrimeMod.h"
#include <VideoCommon/OnScreenDisplay.h>

namespace prime {
class Invulnerability : public PrimeMod {
public:
  void run_mod(Game game, Region region) override {}
  void init_mod(Game game, Region region) override {
    switch (game) {
    case Game::PRIME_1:
      if (region == Region::NTSC) {
        code_changes.emplace_back(0x80186408, 0x3863b6d8);
        code_changes.emplace_back(0x80186414, 0x3863b6d8);
      }
      else if (region == Region::PAL) {
        code_changes.emplace_back(0x801866a0, 0x3863f618);
        code_changes.emplace_back(0x801866ac, 0x3863f618);
      }
      break;
    case Game::PRIME_1_GCN:
      if (region == Region::NTSC) {
        code_changes.emplace_back(0x80011d3c, 0x3863d780);
        code_changes.emplace_back(0x80011d48, 0x3863d780);
      }
      else if (region == Region::PAL) {
        code_changes.emplace_back(0x80012670, 0x3863f820);
        code_changes.emplace_back(0x8001267c, 0x3863f820);
      }
      break;
    case Game::PRIME_2:
      if (region == Region::NTSC) {
        code_changes.emplace_back(0x8014baa4, 0x3c60804e);
        code_changes.emplace_back(0x8014baa8, 0x38633508);
        code_changes.emplace_back(0x8014baac, 0x4e800020);
      }
      else if (region == Region::PAL) {
        code_changes.emplace_back(0x8014d218, 0x3c60804f);
        code_changes.emplace_back(0x8014d21c, 0x3863a958);
        code_changes.emplace_back(0x8014d220, 0x4e800020);
      }
      break;
    case Game::PRIME_2_GCN:
      if (region == Region::NTSC) {
        code_changes.emplace_back(0x8000ec08, 0x3c60803d);
        code_changes.emplace_back(0x8000ec0c, 0x6063aa28);
        code_changes.emplace_back(0x8000ec10, 0x4e800020);
      }
      else if (region == Region::PAL) {
        code_changes.emplace_back(0x8000ec4c, 0x3c60803d);
        code_changes.emplace_back(0x8000ec50, 0x6063bc48);
        code_changes.emplace_back(0x8000ec54, 0x4e800020);
      }
    }
    initialized = true;
  }        

  void on_state_change(ModState old_state) override {
    if (GetHackManager()->get_active_game() != Game::PRIME_3) {
      if (mod_state() != old_state)
        OSD::AddMessage(StringFromFormat("Invulnerability: %s", mod_state() == ModState::ENABLED ? "Enabled" : "Disabled"));
    }
  }
};
}
